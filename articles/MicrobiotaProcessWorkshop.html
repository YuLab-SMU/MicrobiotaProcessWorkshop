<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Workshop of microbiome dataset analysis using MicrobiotaProcess â€¢ MicrobiotaProcessWorkshop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Workshop of microbiome dataset analysis using MicrobiotaProcess">
<meta property="og:description" content="MicrobiotaProcessWorkshop">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-93043521-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-93043521-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MicrobiotaProcessWorkshop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.92</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/MicrobiotaProcessWorkshop.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/xiangpin/MicrobiotaProcessWorkshop">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="MicrobiotaProcessWorkshop_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="MicrobiotaProcessWorkshop_files/kePrint-0.0.1/kePrint.js"></script><link href="MicrobiotaProcessWorkshop_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Workshop of microbiome dataset analysis using MicrobiotaProcess</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/YuLab-SMU/MicrobiotaProcessWorkshop/blob/master/vignettes/MicrobiotaProcessWorkshop.Rmd"><code>vignettes/MicrobiotaProcessWorkshop.Rmd</code></a></small>
      <div class="hidden name"><code>MicrobiotaProcessWorkshop.Rmd</code></div>

    </div>

    
    
<div id="load-required-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#load-required-packages" class="anchor"></a>1. Load required packages</h2>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/MicrobiotaProcess/">MicrobiotaProcess</a></span><span class="op">)</span> <span class="co"># an R package for analysis, visualization and biomarker discovery of Microbiome.</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://dx.plos.org/10.1371/journal.pone.0061217">phyloseq</a></span><span class="op">)</span> <span class="co"># Handling and analysis of high-throughput microbiome census data.</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span> <span class="co"># Create Elegant Data Visualisations Using the Grammar of Graphics.</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span> <span class="co"># Easily Install and Load the 'Tidyverse'.</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org">vegan</a></span><span class="op">)</span> <span class="co"># Community Ecology Package.</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://coin.r-forge.r-project.org">coin</a></span><span class="op">)</span> <span class="co"># Conditional Inference Procedures in a Permutation Test Framework.</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape">reshape2</a></span><span class="op">)</span> <span class="co"># Flexibly Reshape Data: A Reboot of the Reshape Package.</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ggnewscale</span><span class="op">)</span> <span class="co"># Multiple Fill and Colour Scales in 'ggplot2'.</span>
<span class="op">}</span><span class="op">)</span></pre></div>
<p>Here, we use the 43 pediatric IBD stool samples as example, obtained from the Integrative Human Microbiome Project Consortium (iHMP).</p>
<p><img src="img/fig1.png"></p>
</div>
<div id="importing-the-output-of-dada2" class="section level2">
<h2 class="hasAnchor">
<a href="#importing-the-output-of-dada2" class="anchor"></a>2. Importing the output of dada2</h2>
<p>The datasets were obtained from <code>https://www.microbiomeanalyst.ca/MicrobiomeAnalyst/resources/data/ibd_data.zip</code>. It contains <code>ibd_asv_table.txt</code>, which is feature table (<em>row features</em> X <em>column samples</em>), <code>ibd_meta.csv</code>, which is metadata file of samples, and <code>ibd_taxa.txt</code>, which is the taxonomic annotation of features. In the session, we use <code>import_dada2</code> of <code>MicrobiotaProcess</code> to import the datasets, and return a <code>phyloseq</code> object.</p>
<p><img src="img/fig2.png"></p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/MicrobiotaProcess/">MicrobiotaProcess</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://dx.plos.org/10.1371/journal.pone.0061217">phyloseq</a></span><span class="op">)</span>
<span class="va">otuda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"./IBD_data/ibd_asv_table.txt"</span>, header<span class="op">=</span><span class="cn">T</span>, 
                    check.names<span class="op">=</span><span class="cn">F</span>, comment.char<span class="op">=</span><span class="st">""</span>, row.names<span class="op">=</span><span class="fl">1</span>, sep<span class="op">=</span><span class="st">"\t"</span><span class="op">)</span>
<span class="co"># building the output format of removeBimeraDenovo of dada2</span>
<span class="va">otuda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/transpose-methods.html">t</a></span><span class="op">(</span><span class="va">otuda</span><span class="op">)</span>, check.names<span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="va">sampleda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"./IBD_data/ibd_meta.csv"</span>, row.names<span class="op">=</span><span class="fl">1</span>, comment.char<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="va">taxda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"./IBD_data/ibd_taxa.txt"</span>, header<span class="op">=</span><span class="cn">T</span>, 
                    row.names<span class="op">=</span><span class="fl">1</span>, check.names<span class="op">=</span><span class="cn">F</span>, comment.char<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="co"># the feature names should be the same with rownames of taxda. </span>
<span class="va">taxda</span> <span class="op">&lt;-</span> <span class="va">taxda</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">otuda</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">taxda</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span>
<span class="va">psraw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/import_dada2.html">import_dada2</a></span><span class="op">(</span>seqtab<span class="op">=</span><span class="va">otuda</span>, taxatab<span class="op">=</span><span class="va">taxda</span>, sampleda<span class="op">=</span><span class="va">sampleda</span><span class="op">)</span>
<span class="co"># view the reads depth of samples. In this example, </span>
<span class="co"># we remove the sample contained less than 20914 otus.</span>
<span class="co"># sort(rowSums(otu_table(psraw)))</span>

<span class="co"># samples were removed, which the reads number is too little.</span>
<span class="va">psraw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/prune_samples-methods.html">prune_samples</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_sums.html">sample_sums</a></span><span class="op">(</span><span class="va">psraw</span><span class="op">)</span><span class="op">&gt;=</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/otu_table-methods.html">otu_table</a></span><span class="op">(</span><span class="va">psraw</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">psraw</span><span class="op">)</span>
<span class="co"># then the samples were rarefied to 20914 reads.</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1024</span><span class="op">)</span>
<span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/rarefy_even_depth.html">rarefy_even_depth</a></span><span class="op">(</span><span class="va">psraw</span><span class="op">)</span>
<span class="va">ps</span>
<span class="co">#&gt; phyloseq-class experiment-level object</span>
<span class="co">#&gt; otu_table()   OTU Table:         [ 1432 taxa and 41 samples ]</span>
<span class="co">#&gt; sample_data() Sample Data:       [ 41 samples by 1 sample variables ]</span>
<span class="co">#&gt; tax_table()   Taxonomy Table:    [ 1432 taxa by 7 taxonomic ranks ]</span>
<span class="co">#&gt; refseq()      DNAStringSet:      [ 1432 reference sequences ]</span></pre></div>
<div id="other-import" class="section level3">
<h3 class="hasAnchor">
<a href="#other-import" class="anchor"></a>2.1 Other import</h3>
<table class="table table">
<caption>
List of import function
</caption>
<thead><tr>
<th style="text-align:left;">
Package
</th>
<th style="text-align:left;">
Import Function
</th>
<th style="text-align:left;">
Description
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
MicrobiotaProcess
</td>
<td style="text-align:left;">
import_qiime2
</td>
<td style="text-align:left;">
Import function to load the output of qiime2
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: middle !important;" rowspan="5">
phyloseq
</td>
<td style="text-align:left;">
import_biom
</td>
<td style="text-align:left;">
Import phyloseq data from biom-format file
</td>
</tr>
<tr>
<td style="text-align:left;">
import_qiime
</td>
<td style="text-align:left;">
Import function to read the now legacy-format QIIME OTU table
</td>
</tr>
<tr>
<td style="text-align:left;">
import_RDP_otu
</td>
<td style="text-align:left;">
Import new RDP OTU-table format
</td>
</tr>
<tr>
<td style="text-align:left;">
import_uparse
</td>
<td style="text-align:left;">
Import UPARSE file format
</td>
</tr>
<tr>
<td style="text-align:left;">
import_mothur
</td>
<td style="text-align:left;">
General function for importing mothur data files into phyloseq
</td>
</tr>
<tr>
<td style="text-align:left;">
base
</td>
<td style="text-align:left;">
read.table or read.csv
</td>
<td style="text-align:left;">
import table
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="co"># We also can use phyloseq to build phyloseq object.</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://dx.plos.org/10.1371/journal.pone.0061217">phyloseq</a></span><span class="op">)</span>
<span class="va">ps2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/phyloseq.html">phyloseq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/otu_table-methods.html">otu_table</a></span><span class="op">(</span><span class="va">otuda</span>, taxa_are_rows<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html">sample_data</a></span><span class="op">(</span><span class="va">sampleda</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">taxda</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">ps2</span></pre></div>
<details><p><summary>output</summary></p>
<pre><code>#&gt; phyloseq-class experiment-level object
#&gt; otu_table()   OTU Table:         [ 1681 taxa and 43 samples ]
#&gt; sample_data() Sample Data:       [ 43 samples by 1 sample variables ]
#&gt; tax_table()   Taxonomy Table:    [ 1681 taxa by 7 taxonomic ranks ]</code></pre>
</details>
</div>
</div>
<div id="alpha-diversity-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#alpha-diversity-analysis" class="anchor"></a>3. alpha diversity analysis</h2>
<div id="rarefaction-visualization" class="section level3">
<h3 class="hasAnchor">
<a href="#rarefaction-visualization" class="anchor"></a>3.1 rarefaction visualization</h3>
<p>Rarefaction, based on sampling technique, was used to compensate for the effect of sample size on the number of units observed in a sample. <code>MicrobiotaProcess</code> provided <code>ggrarecurve</code> to plot the curves, based on <code>rrarefy</code> of <code>vegan</code></p>
<p><img src="img/fig3.png"></p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/MicrobiotaProcess/">MicrobiotaProcess</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>
<span class="co"># for reproducibly random number</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1024</span><span class="op">)</span>
<span class="va">p_rare</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggrarecurve.html">ggrarecurve</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">ps</span>,
                      indexNames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Observe"</span>,<span class="st">"Chao1"</span>,<span class="st">"ACE"</span><span class="op">)</span>,
                      chunks<span class="op">=</span><span class="fl">400</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.spacing.y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="st">"cm"</span><span class="op">)</span>,
                legend.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1024</span><span class="op">)</span>
<span class="va">prare1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggrarecurve.html">ggrarecurve</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">ps</span>, factorNames<span class="op">=</span><span class="st">"Group"</span>,
                      indexNames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Observe"</span>, <span class="st">"Chao1"</span>, <span class="st">"ACE"</span><span class="op">)</span>,
                      chunks<span class="op">=</span><span class="fl">400</span>, se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AED7"</span>, <span class="st">"#FD9347"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AED7"</span>, <span class="st">"#FD9347"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">8</span><span class="op">)</span>, panel.grid<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>colour<span class="op">=</span><span class="cn">NA</span>,fill<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span>,
                strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">p_rare</span> <span class="op">/</span> <span class="va">prare1</span></pre></div>
<div class="figure" style="text-align: center">
<img src="MicrobiotaProcessWorkshop_files/figure-html/rarecurve-1.png" alt="\label{fig:Rarecurve}Example of rarefaction curve of samples" width="912"><p class="caption">
Example of rarefaction curve of samples
</p>
</div>
<p>Since the curves in each sample were near saturation, the sequencing data were great enough with very few new species undetected</p>
</div>
<div id="calculation-and-different-analysis-of-alpha-index" class="section level3">
<h3 class="hasAnchor">
<a href="#calculation-and-different-analysis-of-alpha-index" class="anchor"></a>3.2 Calculation and different analysis of alpha index</h3>
<p>Alpha index can evaluate the richness and abundance of microbial communities. <code>MicrobiotaProcess</code> provides <code>get_alphaindex</code> to calculate alpha index. Six common diversity measures (<em>Observe</em>, <em>Chao1</em>, <em>ACE</em>, <em>Shannon</em>, <em>Simpson</em>, <em>J</em>) are supported. And the different groups of samples can be tested and visualize by <code>ggbox</code>.</p>
<p><img src="img/fig4.png"></p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/MicrobiotaProcess/">MicrobiotaProcess</a></span><span class="op">)</span>
<span class="va">alphaobj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/get_alphaindex.html">get_alphaindex</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">alphaobj</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;         Observe    Chao1       ACE  Shannon   Simpson         J   Group</span>
<span class="co">#&gt; S206700      86  93.0000  90.13504 2.868408 0.8911390 0.6439570      CD</span>
<span class="co">#&gt; S206701      45  45.0000  45.00000 1.634528 0.5614782 0.4293861      CD</span>
<span class="co">#&gt; S206702      38  39.5000  39.31896 0.509799 0.1502078 0.1401476      CD</span>
<span class="co">#&gt; S206703     156 157.6667 157.89265 3.507910 0.9104597 0.6946554 Control</span>
<span class="co">#&gt; S206704     155 160.0000 157.08120 3.946515 0.9642167 0.7825068 Control</span>
<span class="co">#&gt; S206708     113 118.0000 114.51622 2.747711 0.8443571 0.5812324      CD</span></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">p_alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggbox.html">ggbox</a></span><span class="op">(</span><span class="va">alphaobj</span>, geom<span class="op">=</span><span class="st">"violin"</span>, factorNames<span class="op">=</span><span class="st">"Group"</span><span class="op">)</span> <span class="op">+</span>
           <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AED7"</span>, <span class="st">"#FD9347"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
           <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>colour<span class="op">=</span><span class="cn">NA</span>, fill<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span><span class="op">)</span>
<span class="va">p_alpha</span></pre></div>
<div class="figure" style="text-align: center">
<img src="MicrobiotaProcessWorkshop_files/figure-html/alphatest-1.png" alt="\label{fig:Alphabox}Example of alpha box of samples" width="768"><p class="caption">
Example of alpha box of samples
</p>
</div>
</div>
</div>
<div id="taxonomy-composition-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#taxonomy-composition-analysis" class="anchor"></a>4. Taxonomy composition analysis</h2>
<div id="statistics-and-visualization-of-specific-levels" class="section level3">
<h3 class="hasAnchor">
<a href="#statistics-and-visualization-of-specific-levels" class="anchor"></a>4.1 Statistics and visualization of specific levels</h3>
<p><code>MicrobiotaProcess</code> presents the <code>ggbartax</code> for the visualization of composition of microbial communities. If you want to get the abundance of specific levels of class, You can use <code>get_taxadf</code> then use <code>ggbartax</code> to visualize.</p>
<p><img src="img/fig5.png"></p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/MicrobiotaProcess/">MicrobiotaProcess</a></span><span class="op">)</span>

<span class="va">classtaxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/get_taxadf.html">get_taxadf</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">ps</span>, taxlevel<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
<span class="co"># The 30 most abundant taxonomy will be visualized by default (parameter `topn=30`). </span>
<span class="va">pclass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggbartax.html">ggbartax</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">classtaxa</span>, facetNames<span class="op">=</span><span class="st">"Group"</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"relative abundance (%)"</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">12</span>,<span class="st">"Set3"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">31</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill<span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth <span class="op">=</span> <span class="fl">0.5</span>, keyheight <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="va">pclass</span></pre></div>
<div class="figure" style="text-align: center">
<img src="MicrobiotaProcessWorkshop_files/figure-html/abundance-1.png" alt="\label{fig:Abundance1}Example of taxonomic abundance of samples" width="816"><p class="caption">
Example of taxonomic abundance of samples
</p>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="co"># Show the abundance in different groups.</span>
<span class="va">fclass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggbartax.html">ggbartax</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">classtaxa</span>, facetNames<span class="op">=</span><span class="st">"Group"</span>, plotgroup<span class="op">=</span><span class="cn">TRUE</span>, topn<span class="op">=</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"relative abundance (%)"</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">12</span>,<span class="st">"Set3"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">31</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill<span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth <span class="op">=</span> <span class="fl">0.5</span>, keyheight <span class="op">=</span> <span class="fl">0.5</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">fclass</span></pre></div>
<details><p><summary>plot</summary></p>
<p><img src="MicrobiotaProcessWorkshop_files/figure-html/unnamed-chunk-4-1.png" width="384" style="display: block; margin: auto;"></p>
</details><p>If you want to view the count of taxonomy, you can set the <code>count</code> parameter of <code>ggbartax</code> to <code>TRUE</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="va">pclass2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggbartax.html">ggbartax</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">classtaxa</span>, count<span class="op">=</span><span class="cn">TRUE</span>, facetNames<span class="op">=</span><span class="st">"Group"</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"count reads"</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">12</span>,<span class="st">"Set3"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">31</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill<span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth <span class="op">=</span> <span class="fl">0.5</span>, keyheight <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="va">pclass2</span></pre></div>
<div class="figure" style="text-align: center">
<img src="MicrobiotaProcessWorkshop_files/figure-html/abundance2-1.png" alt="\label{fig:Abundance2}Example of taxonomic abundance (Count) of samples" width="816"><p class="caption">
Example of taxonomic abundance (Count) of samples
</p>
</div>
</div>
<div id="venn-or-upset-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#venn-or-upset-plot" class="anchor"></a>4.2 Venn or Upset plot</h3>
<p>The Venn or UpSet plot can help us to obtain the difference between groups in overview. MicrobiotaProcess provides features to obtain the input of VennDiagram or UpSet package.</p>
<p><img src="img/fig6.png"></p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="va">vennlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/get_vennlist.html">get_vennlist</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">ps</span>, factorNames<span class="op">=</span><span class="st">"Group"</span><span class="op">)</span>
<span class="va">upsetda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/get_upset.html">get_upset</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">ps</span>, factorNames<span class="op">=</span><span class="st">"Group"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">VennDiagram</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/hms-dbmi/UpSetR">UpSetR</a></span><span class="op">)</span>
<span class="va">vennp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VennDiagram/man/venn.diagram.html">venn.diagram</a></span><span class="op">(</span><span class="va">vennlist</span>,
                      height<span class="op">=</span><span class="fl">5</span>,
                      width<span class="op">=</span><span class="fl">5</span>, 
                      filename<span class="op">=</span><span class="cn">NULL</span>, 
                      fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AED7"</span>, <span class="st">"#FD9347"</span><span class="op">)</span>,
                      cat.col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AED7"</span>, <span class="st">"#FD9347"</span><span class="op">)</span>,
                      alpha <span class="op">=</span> <span class="fl">0.85</span>, 
                      fontfamily <span class="op">=</span> <span class="st">"serif"</span>,
                      fontface <span class="op">=</span> <span class="st">"bold"</span>,
                      cex <span class="op">=</span> <span class="fl">1.2</span>,
                      cat.cex <span class="op">=</span> <span class="fl">1.3</span>,
                      cat.default.pos <span class="op">=</span> <span class="st">"outer"</span>,
                      cat.dist<span class="op">=</span><span class="fl">0.1</span>,
                      margin <span class="op">=</span> <span class="fl">0.1</span>, 
                      lwd <span class="op">=</span> <span class="fl">3</span>,
                      lty <span class="op">=</span><span class="st">'dotted'</span>,
                      imagetype <span class="op">=</span> <span class="st">"svg"</span><span class="op">)</span>
<span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.draw.html">grid.draw</a></span><span class="op">(</span><span class="va">vennp</span><span class="op">)</span></pre></div>
<div class="figure" style="text-align: center">
<img src="MicrobiotaProcessWorkshop_files/figure-html/Venn-1.png" alt="\label{fig:PCA}Example of Venn plot" width="288"><p class="caption">
Example of Venn plot
</p>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/UpSetR/man/upset.html">upset</a></span><span class="op">(</span><span class="va">upsetda</span>, sets<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html">sample_data</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span><span class="op">)</span>, 
      sets.bar.color <span class="op">=</span> <span class="st">"#56B4E9"</span>,
      order.by <span class="op">=</span> <span class="st">"freq"</span>, 
      empty.intersections <span class="op">=</span> <span class="st">"on"</span><span class="op">)</span></pre></div>
<div class="figure" style="text-align: center">
<img src="MicrobiotaProcessWorkshop_files/figure-html/Upset-1.png" alt="\label{fig:PCA}Example of Upset plot" width="480"><p class="caption">
Example of Upset plot
</p>
</div>
</div>
</div>
<div id="beta-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#beta-analysis" class="anchor"></a>5. beta analysis</h2>
<div id="pca-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#pca-analysis" class="anchor"></a>5.1 PCA analysis</h3>
<p><code>PCA</code> (Principal component analysis) and <code>PCoA</code> (Principal Coordinate Analysis) are general statistical procedures to compare groups of samples. And <code>PCoA</code> can based on the phylogenetic or count-based distance metrics, such as <code>Bray-Curtis</code>, <code>Jaccard</code>, <code>Unweighted-UniFrac</code> and <code>weighted-UniFrac</code>. <code>MicrobiotaProcess</code> presents the <code>get_pca</code>, <code>get_pcoa</code> and <code>ggordpoint</code> for the analysis.</p>
<p><img src="img/fig7.png"></p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/MicrobiotaProcess/">MicrobiotaProcess</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>
<span class="co"># If the input was normalized, the method parameter should be setted NULL.</span>
<span class="va">pcares</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/get_pca.html">get_pca</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">ps</span>, method<span class="op">=</span><span class="st">"hellinger"</span><span class="op">)</span>
<span class="co"># Visulizing the result</span>
<span class="va">pcaplot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggordpoint.html">ggordpoint</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">pcares</span>, biplot<span class="op">=</span><span class="cn">TRUE</span>, speciesannot<span class="op">=</span><span class="cn">TRUE</span>,
                      factorNames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span>, ellipse<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AED7"</span>, <span class="st">"#FD9347"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># pc = c(1, 3) to show the first and third principal components.</span>
<span class="va">pcaplot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggordpoint.html">ggordpoint</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">pcares</span>, pc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, biplot<span class="op">=</span><span class="cn">TRUE</span>, speciesannot<span class="op">=</span><span class="cn">TRUE</span>,
                       factorNames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span>, ellipse<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AED7"</span>, <span class="st">"#FD9347"</span><span class="op">)</span><span class="op">)</span>
<span class="va">pcaplot1</span> <span class="op">|</span> <span class="va">pcaplot2</span></pre></div>
<div class="figure" style="text-align: center">
<img src="MicrobiotaProcessWorkshop_files/figure-html/PCAplot-1.png" alt="\label{fig:PCA}Example of PCA of samples" width="864"><p class="caption">
Example of PCA of samples
</p>
</div>
</div>
<div id="pcoa-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#pcoa-analysis" class="anchor"></a>5.2 PCoA analysis</h3>
<p><img src="img/fig7.png"></p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="co"># distmethod</span>
<span class="co"># "unifrac",  "wunifrac", "manhattan", "euclidean", "canberra", "bray", "kulczynski" ...(vegdist, dist)</span>
<span class="va">pcoares</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/get_pcoa.html">get_pcoa</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">ps</span>, distmethod<span class="op">=</span><span class="st">"bray"</span>, method<span class="op">=</span><span class="st">"hellinger"</span><span class="op">)</span>
<span class="co"># Visualizing the result</span>
<span class="va">pcoaplot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggordpoint.html">ggordpoint</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">pcoares</span>, biplot<span class="op">=</span><span class="cn">TRUE</span>, speciesannot<span class="op">=</span><span class="cn">TRUE</span>,
                       factorNames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span>, ellipse<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AED7"</span>, <span class="st">"#FD9347"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># first and third principal co-ordinates</span>
<span class="va">pcoaplot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggordpoint.html">ggordpoint</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">pcoares</span>, pc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, biplot<span class="op">=</span><span class="cn">TRUE</span>, speciesannot<span class="op">=</span><span class="cn">TRUE</span>,
                        factorNames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span>, ellipse<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AED7"</span>, <span class="st">"#FD9347"</span><span class="op">)</span><span class="op">)</span>
<span class="va">pcoaplot1</span> <span class="op">|</span> <span class="va">pcoaplot2</span></pre></div>
<div class="figure" style="text-align: center">
<img src="MicrobiotaProcessWorkshop_files/figure-html/PCoAplot-1.png" alt="\label{fig:PCoA}Example of PCoA of samples" width="864"><p class="caption">
Example of PCoA of samples
</p>
</div>
</div>
<div id="permutational-multivariate-analysis-of-variance" class="section level3">
<h3 class="hasAnchor">
<a href="#permutational-multivariate-analysis-of-variance" class="anchor"></a>5.3 Permutational Multivariate Analysis of Variance</h3>
<p>We also can perform the Permutational Multivariate Analysis of Variance using the <code>vegan</code></p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="va">distme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/get_dist.html">get_dist</a></span><span class="op">(</span><span class="va">ps</span>, distmethod <span class="op">=</span><span class="st">"bray"</span>, method<span class="op">=</span><span class="st">"hellinger"</span><span class="op">)</span>
<span class="va">sampleda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html">sample_data</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span>, check.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">sampleda</span> <span class="op">&lt;-</span> <span class="va">sampleda</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">distme</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sampleda</span><span class="op">)</span><span class="op">)</span>,,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span>
<span class="va">sampleda</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">sampleda</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1024</span><span class="op">)</span>
<span class="va">adores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/adonis.html">adonis</a></span><span class="op">(</span><span class="va">distme</span> <span class="op">~</span> <span class="va">Group</span>, data<span class="op">=</span><span class="va">sampleda</span>, permutation<span class="op">=</span><span class="fl">9999</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">adores</span><span class="op">$</span><span class="va">aov.tab</span><span class="op">)</span></pre></div>
<details><p><summary>output</summary></p>
<pre><code>#&gt;           Df  SumsOfSqs   MeanSqs  F.Model         R2 Pr..F.
#&gt; Group      1  0.7645291 0.7645291 3.199178 0.07581139  1e-04
#&gt; Residuals 39  9.3200922 0.2389767       NA 0.92418861     NA
#&gt; Total     40 10.0846214        NA       NA 1.00000000     NA</code></pre>
</details>
</div>
<div id="hierarchical-cluster-analysis-of-samples" class="section level3">
<h3 class="hasAnchor">
<a href="#hierarchical-cluster-analysis-of-samples" class="anchor"></a>5.4 hierarchical cluster analysis of samples</h3>
<p><code>beta diversity</code> metrics can assess the differences between microbial communities. It can be visualized with <code>PCA</code> or <code>PCoA</code>, this can also be visualized with hierarchical clustering. <code>MicrobiotaProcess</code> implements the analysis based on <code>ggtree</code>.</p>
<p><img src="img/fig8.png"></p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/MicrobiotaProcess/">MicrobiotaProcess</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>
<span class="va">hcsample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/get_clust.html">get_clust</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">ps</span>, distmethod<span class="op">=</span><span class="st">"bray"</span>,
                      method<span class="op">=</span><span class="st">"hellinger"</span>, hclustmethod<span class="op">=</span><span class="st">"average"</span><span class="op">)</span>
<span class="co"># rectangular layout</span>
<span class="va">cplot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggclust.html">ggclust</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">hcsample</span>,
                  layout <span class="op">=</span> <span class="st">"rectangular"</span>,
                  pointsize<span class="op">=</span><span class="fl">1</span>,
                  fontsize<span class="op">=</span><span class="fl">0</span>,
                  factorNames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span>
              <span class="op">)</span> <span class="op">+</span>
              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AED7"</span>, <span class="st">"#FD9347"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
              <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/theme_tree2.html">theme_tree2</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"right"</span>,
              plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face<span class="op">=</span><span class="st">"bold"</span>, lineheight<span class="op">=</span><span class="fl">25</span>,hjust<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="co"># circular layout</span>
<span class="va">cplot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggclust.html">ggclust</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">hcsample</span>,
                  layout <span class="op">=</span> <span class="st">"circular"</span>,
                  pointsize<span class="op">=</span><span class="fl">1</span>,
                  fontsize<span class="op">=</span><span class="fl">2</span>,
                  factorNames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span>
          <span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AED7"</span>, <span class="st">"#FD9347"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"right"</span><span class="op">)</span>
<span class="va">cplot1</span> <span class="op">|</span> <span class="va">cplot2</span></pre></div>
<div class="figure" style="text-align: center">
<img src="MicrobiotaProcessWorkshop_files/figure-html/Clust-1.png" alt="\label{fig:HClust}Example of hierarchical clustering of samples" width="960"><p class="caption">
Example of hierarchical clustering of samples
</p>
</div>
</div>
</div>
<div id="biomarker-discovery" class="section level2">
<h2 class="hasAnchor">
<a href="#biomarker-discovery" class="anchor"></a>6. biomarker discovery</h2>
<p>This package provides <code>diff_analysis</code> to detect the biomarker. And the results can be visualized by <code>ggdiffbox</code>, <code>ggdiffclade</code>, <code>ggeffectsize</code> and <code>ggdifftaxbar</code></p>
<p><img src="img/fig9.png"></p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="co"># for the kruskal_test and wilcox_test</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://coin.r-forge.r-project.org">coin</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/MicrobiotaProcess/">MicrobiotaProcess</a></span><span class="op">)</span>
<span class="co"># Since the effect size was calculated by randomly re-sampling, </span>
<span class="co"># the seed should be set for reproducibly results.</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1024</span><span class="op">)</span>
<span class="va">deres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/diff_analysis.html">diff_analysis</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">ps</span>, classgroup <span class="op">=</span> <span class="st">"Group"</span>,
                       mlfun <span class="op">=</span> <span class="st">"lda"</span>,
                       filtermod <span class="op">=</span> <span class="st">"pvalue"</span>,
                       firstcomfun <span class="op">=</span> <span class="st">"kruskal_test"</span>,
                       firstalpha <span class="op">=</span> <span class="fl">0.05</span>,
                       strictmod <span class="op">=</span> <span class="cn">TRUE</span>,
                       secondcomfun <span class="op">=</span> <span class="st">"wilcox_test"</span>,
                       subclmin <span class="op">=</span> <span class="fl">3</span>,
                       subclwilc <span class="op">=</span> <span class="cn">TRUE</span>,
                       secondalpha <span class="op">=</span> <span class="fl">0.01</span>,
                       lda<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
<span class="va">deres</span>
<span class="co">#&gt; The original data: 689 features and 41 samples</span>
<span class="co">#&gt; The sample data: 1 variables and 41 samples</span>
<span class="co">#&gt; The taxda contained 1432 by 7 rank</span>
<span class="co">#&gt; after first test (kruskal_test) number of feature (pvalue&lt;=0.05):71</span>
<span class="co">#&gt; after second test (wilcox_test) number of significantly discriminative feature:28</span>
<span class="co">#&gt; after lda, Number of discriminative features: 22 (certain taxonomy classification:15; uncertain taxonomy classication: 7)</span></pre></div>
<div id="visualization-of-different-results-by-ggdiffclade" class="section level3">
<h3 class="hasAnchor">
<a href="#visualization-of-different-results-by-ggdiffclade" class="anchor"></a>6.1 visualization of different results by <code>ggdiffclade</code>
</h3>
<p>The color of discriminative taxa represent the taxa is more abundant in the corresponding group. The point size shows the negative logarithms (base 10) of pvalue. The bigger size of point shows more significant (lower pvalue), the pvalue was calculated in the first step test.</p>
<p><img src="img/fig9.png"></p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="va">diffclade_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggdiffclade.html">ggdiffclade</a></span><span class="op">(</span>
                   obj<span class="op">=</span><span class="va">deres</span>, 
                   alpha<span class="op">=</span><span class="fl">0.3</span>, 
                   linewd<span class="op">=</span><span class="fl">0.15</span>,
                   skpointsize<span class="op">=</span><span class="fl">0.6</span>, 
                   layout<span class="op">=</span><span class="st">"radial"</span>,
                   taxlevel<span class="op">=</span><span class="fl">3</span>, 
                   removeUnkown<span class="op">=</span><span class="cn">TRUE</span>,
                   reduce<span class="op">=</span><span class="cn">TRUE</span> <span class="co"># This argument is to remove the branch of unknown taxonomy.</span>
               <span class="op">)</span> <span class="op">+</span>
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>
                   values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AED7"</span>, <span class="st">"#FD9347"</span><span class="op">)</span>
               <span class="op">)</span> <span class="op">+</span>
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>
                                  keywidth <span class="op">=</span> <span class="fl">0.1</span>, 
                                  keyheight <span class="op">=</span> <span class="fl">0.6</span>,
                                  order <span class="op">=</span> <span class="fl">3</span>,
                                  ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
               <span class="op">)</span> <span class="op">+</span>
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
                   panel.background<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>,
                   legend.position<span class="op">=</span><span class="st">"right"</span>, 
                   plot.margin<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
                   legend.spacing.y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="st">"cm"</span><span class="op">)</span>, 
                   legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">7</span><span class="op">)</span>,
                   legend.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span><span class="op">)</span>, 
                   legend.box.spacing<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.02</span>,<span class="st">"cm"</span><span class="op">)</span>
               <span class="op">)</span>
<span class="va">diffclade_p</span></pre></div>
<div class="figure" style="text-align: center">
<img src="MicrobiotaProcessWorkshop_files/figure-html/plotclade-1.png" alt="\label{fig:clade}Example of different biomarker clade" width="576"><p class="caption">
Example of different biomarker clade
</p>
</div>
</div>
<div id="visualization-of-different-results-by-ggdiffbox" class="section level3">
<h3 class="hasAnchor">
<a href="#visualization-of-different-results-by-ggdiffbox" class="anchor"></a>6.2 visualization of different results by <code>ggdiffbox</code>
</h3>
<p>The left panel represents the relative abundance or abundance (according the standard_method) of biomarker, the right panel represents the confident interval of effect size (LDA or MDA) of biomarker. The bigger confident interval shows that the biomarker is more fluctuant, owing to the influence of samples number.</p>
<p><img src="img/fig10.png"></p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="va">diffbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggdiffbox.html">ggdiffbox</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">deres</span>, box_notch<span class="op">=</span><span class="cn">FALSE</span>, 
             colorlist<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AED7"</span>, <span class="st">"#FD9347"</span><span class="op">)</span>, l_xlabtext<span class="op">=</span><span class="st">"relative abundance"</span><span class="op">)</span>
<span class="va">diffbox</span></pre></div>
<div class="figure" style="text-align: center">
<img src="MicrobiotaProcessWorkshop_files/figure-html/diffbox-1.png" alt="\label{fig:diffboxplot}Example of biomarker boxplot and effect size" width="576"><p class="caption">
Example of biomarker boxplot and effect size
</p>
</div>
</div>
<div id="visualization-of-different-results-by-ggdifftaxbar" class="section level3">
<h3 class="hasAnchor">
<a href="#visualization-of-different-results-by-ggdifftaxbar" class="anchor"></a>6.3 visualization of different results by <code>ggdifftaxbar</code>
</h3>
<p><code>ggdifftaxbar</code> can visualize the abundance of biomarker in each samples of groups, the mean and median abundance of groups or subgroups are also showed. <code>output</code> parameter is the directory of output.</p>
<p><img src="img/fig11.png"></p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggdifftaxbar.html">ggdifftaxbar</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">deres</span>, xtextsize<span class="op">=</span><span class="fl">1.5</span>, 
             output<span class="op">=</span><span class="st">"IBD_biomarkder_barplot"</span>,
             coloslist<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AED7"</span>, <span class="st">"#FD9347"</span><span class="op">)</span><span class="op">)</span></pre></div>
</div>
<div id="visualization-of-different-results-by-ggeffectsize" class="section level3">
<h3 class="hasAnchor">
<a href="#visualization-of-different-results-by-ggeffectsize" class="anchor"></a>6.4 visualization of different results by <code>ggeffectsize</code>
</h3>
<p>The result is similar with the result of <code>ggdiffbox</code>, the bigger confident interval shows that the biomarker is more fluctuant owing to the influence of samples number.</p>
<p><img src="img/fig12.png"></p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="va">es_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggeffectsize.html">ggeffectsize</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">deres</span>, 
                     lineheight<span class="op">=</span><span class="fl">0.1</span>,
                     linewidth<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span> 
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AED7"</span>, 
                                    <span class="st">"#FD9347"</span><span class="op">)</span><span class="op">)</span> 

<span class="va">es_p</span></pre></div>
<div class="figure" style="text-align: center">
<img src="MicrobiotaProcessWorkshop_files/figure-html/plotES-1.png" alt="\label{fig:ESplot}Example of effect size of biomarker" width="480"><p class="caption">
Example of effect size of biomarker
</p>
</div>
</div>
</div>
<div id="correlation-of-taxonomy" class="section level2">
<h2 class="hasAnchor">
<a href="#correlation-of-taxonomy" class="anchor"></a>7. Correlation of taxonomy</h2>
<p>The result of different analysis also can be visualized with result of correlation.</p>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="va">genustab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/get_taxadf.html">get_taxadf</a></span><span class="op">(</span><span class="va">ps</span>, taxlevel<span class="op">=</span><span class="fl">6</span><span class="op">)</span>
<span class="va">genustab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/transpose-methods.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/otu_table-methods.html">otu_table</a></span><span class="op">(</span><span class="va">genustab</span><span class="op">)</span><span class="op">)</span>, check.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">genustab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">genustab</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="va">x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, check.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="va">cortest</span> <span class="op">&lt;-</span> <span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/corAndPvalue.html">corAndPvalue</a></span><span class="op">(</span><span class="va">genustab</span>, method<span class="op">=</span><span class="st">"spearman"</span>, alternative<span class="op">=</span><span class="st">"two.sided"</span><span class="op">)</span>
<span class="va">cortest</span><span class="op">$</span><span class="va">cor</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">upper.tri</a></span><span class="op">(</span><span class="va">cortest</span><span class="op">$</span><span class="va">cor</span>, diag <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">cortest</span><span class="op">$</span><span class="va">p</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">upper.tri</a></span><span class="op">(</span><span class="va">cortest</span><span class="op">$</span><span class="va">p</span>, diag <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">cortab1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/transpose-methods.html">t</a></span><span class="op">(</span><span class="va">cortest</span><span class="op">$</span><span class="va">cor</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">rename</span><span class="op">(</span>from<span class="op">=</span><span class="va">Var1</span>,to<span class="op">=</span><span class="va">Var2</span>,cor<span class="op">=</span><span class="va">value</span><span class="op">)</span>
<span class="va">corptab1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/transpose-methods.html">t</a></span><span class="op">(</span><span class="va">cortest</span><span class="op">$</span><span class="va">p</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">rename</span><span class="op">(</span>pvalue<span class="op">=</span><span class="va">value</span><span class="op">)</span>
<span class="va">cortab1</span><span class="op">$</span><span class="va">fdr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">corptab1</span><span class="op">$</span><span class="va">pvalue</span>, method<span class="op">=</span><span class="st">"fdr"</span><span class="op">)</span>

<span class="va">cortab1</span> <span class="op">&lt;-</span> <span class="va">cortab1</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>correlation<span class="op">=</span><span class="fu">case_when</span><span class="op">(</span><span class="va">cor</span><span class="op">&gt;</span><span class="fl">0</span> <span class="op">~</span> <span class="st">"positive"</span>,<span class="va">cor</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"negative"</span>,<span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"No"</span><span class="op">)</span><span class="op">)</span>
<span class="va">cortab2</span> <span class="op">&lt;-</span> <span class="va">cortab1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">fdr</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">cor</span> <span class="op">&lt;=</span> <span class="op">-</span><span class="fl">0.5</span> <span class="op">|</span> <span class="va">cor</span> <span class="op">&gt;=</span> <span class="fl">0.8</span><span class="op">)</span>

<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/ggdiffclade.html">ggdiffclade</a></span><span class="op">(</span>
         obj<span class="op">=</span><span class="va">deres</span>,
         alpha<span class="op">=</span><span class="fl">0.3</span>,
         linewd<span class="op">=</span><span class="fl">0.25</span>,
         skpointsize<span class="op">=</span><span class="fl">0.2</span>,
         layout<span class="op">=</span><span class="st">"inward_circular"</span>,
         taxlevel<span class="op">=</span><span class="fl">7</span>,
         cladetext<span class="op">=</span><span class="fl">0</span>,
         setColors<span class="op">=</span><span class="cn">FALSE</span>,
         xlim<span class="op">=</span><span class="fl">16</span>
     <span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AED7"</span>, <span class="st">"#FD9347"</span><span class="op">)</span>,
                       guide<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth<span class="op">=</span><span class="fl">0.5</span>,
                                          keyheight<span class="op">=</span><span class="fl">0.5</span>,
                                          order<span class="op">=</span><span class="fl">3</span>,
                                          override.aes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
     <span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size_continuous</a></span><span class="op">(</span>range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,
                       guide<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth<span class="op">=</span><span class="fl">0.5</span>,keyheight<span class="op">=</span><span class="fl">0.5</span>,order<span class="op">=</span><span class="fl">4</span>,
                                          override.aes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape<span class="op">=</span><span class="fl">21</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="fl">100</span><span class="op">)</span>,guide<span class="op">=</span><span class="st">"none"</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggnewscale/man/new_scale.html">new_scale_color</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggnewscale/man/new_scale.html">new_scale</a></span><span class="op">(</span><span class="st">"size"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_taxalink.html">geom_taxalink</a></span><span class="op">(</span>
          data<span class="op">=</span><span class="va">cortab2</span>,
          mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>taxa1<span class="op">=</span><span class="va">from</span>,
                      taxa2<span class="op">=</span><span class="va">to</span>,
                      colour<span class="op">=</span><span class="va">correlation</span>,
                      size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">cor</span><span class="op">)</span><span class="op">)</span>,
          alpha<span class="op">=</span><span class="fl">0.4</span>,
          ncp<span class="op">=</span><span class="fl">10</span>,
          hratio<span class="op">=</span><span class="fl">1</span>,
          offset<span class="op">=</span><span class="fl">1.2</span>
      <span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">1</span><span class="op">)</span>,
                            guide<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth<span class="op">=</span><span class="fl">1</span>, keyheight<span class="op">=</span><span class="fl">0.5</span>,
                                               order<span class="op">=</span><span class="fl">1</span>, override.aes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
      <span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"chocolate2"</span>, <span class="st">"#009E73"</span><span class="op">)</span>,
                          guide<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth<span class="op">=</span><span class="fl">0.5</span>, keyheight<span class="op">=</span><span class="fl">0.5</span>,
                          order<span class="op">=</span><span class="fl">2</span>, override.aes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">1</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">p2</span></pre></div>
<details><p><summary>plot</summary></p>
<div class="figure" style="text-align: center">
<img src="MicrobiotaProcessWorkshop_files/figure-html/plotcorAnddiff-1.png" alt="\label{fig:clade}Example of different biomarker clade and correlation of genera" width="576"><p class="caption">
Example of different biomarker clade and correlation of genera
</p>
</div>
</details>
</div>
<div id="session-information" class="section level2">
<h2 class="hasAnchor">
<a href="#session-information" class="anchor"></a>8. Session information</h2>
<p>Here is the output of <code><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo()</a></code> on the system on which this document was compiled:</p>
<details><p><summary>output</summary></p>
<pre><code>#&gt; R version 4.0.2 (2020-06-22)
#&gt; Platform: x86_64-pc-linux-gnu (64-bit)
#&gt; Running under: Ubuntu 20.04 LTS
#&gt; 
#&gt; Matrix products: default
#&gt; BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.8.so
#&gt; 
#&gt; locale:
#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
#&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
#&gt; 
#&gt; attached base packages:
#&gt; [1] grid      stats     graphics  grDevices utils     datasets  methods  
#&gt; [8] base     
#&gt; 
#&gt; other attached packages:
#&gt;  [1] gdtools_0.2.2            ggtree_2.3.7             UpSetR_1.4.0            
#&gt;  [4] VennDiagram_1.6.20       futile.logger_1.4.3      patchwork_1.0.1         
#&gt;  [7] kableExtra_1.2.1         ggnewscale_0.4.3         reshape2_1.4.4          
#&gt; [10] coin_1.3-1               survival_3.2-7           vegan_2.5-6             
#&gt; [13] lattice_0.20-41          permute_0.9-5            forcats_0.5.0           
#&gt; [16] stringr_1.4.0            dplyr_1.0.2              purrr_0.3.4             
#&gt; [19] readr_1.4.0              tidyr_1.1.2              tibble_3.0.4            
#&gt; [22] tidyverse_1.3.0          ggplot2_3.3.2            phyloseq_1.33.0         
#&gt; [25] MicrobiotaProcess_1.1.10
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;   [1] readxl_1.3.1          backports_1.1.10      Hmisc_4.4-1          
#&gt;   [4] fastmatch_1.1-0       systemfonts_0.3.2     plyr_1.8.6           
#&gt;   [7] igraph_1.2.6          selectr_0.4-2         lazyeval_0.2.2       
#&gt;  [10] splines_4.0.2         TH.data_1.0-10        digest_0.6.25        
#&gt;  [13] foreach_1.5.1         htmltools_0.5.0       GO.db_3.12.0         
#&gt;  [16] fansi_0.4.1           checkmate_2.0.0       magrittr_1.5         
#&gt;  [19] memoise_1.1.0         doParallel_1.0.16     cluster_2.1.0        
#&gt;  [22] DECIPHER_2.17.1       fastcluster_1.1.25    Biostrings_2.57.2    
#&gt;  [25] modelr_0.1.8          matrixStats_0.57.0    svglite_1.2.3.2      
#&gt;  [28] sandwich_3.0-0        pkgdown_1.6.1         jpeg_0.1-8.1         
#&gt;  [31] colorspace_1.4-1      blob_1.2.1            rvest_0.3.6          
#&gt;  [34] ggrepel_0.8.2         textshaping_0.1.2     haven_2.3.1          
#&gt;  [37] xfun_0.18             crayon_1.3.4          jsonlite_1.7.1       
#&gt;  [40] libcoin_1.0-6         impute_1.63.0         zoo_1.8-8            
#&gt;  [43] phangorn_2.5.5        iterators_1.0.13      ape_5.4-1            
#&gt;  [46] glue_1.4.2            gtable_0.3.0          zlibbioc_1.35.0      
#&gt;  [49] XVector_0.29.3        webshot_0.5.2         Rhdf5lib_1.11.3      
#&gt;  [52] BiocGenerics_0.35.4   rentrez_1.2.2         scales_1.1.1         
#&gt;  [55] futile.options_1.0.1  mvtnorm_1.1-1         DBI_1.1.0            
#&gt;  [58] Rcpp_1.0.5            htmlTable_2.1.0       viridisLite_0.3.0    
#&gt;  [61] tidytree_0.3.3        foreign_0.8-80        bit_4.0.4            
#&gt;  [64] preprocessCore_1.51.0 Formula_1.2-3         stats4_4.0.2         
#&gt;  [67] htmlwidgets_1.5.2     httr_1.4.2            RColorBrewer_1.1-2   
#&gt;  [70] modeltools_0.2-23     ellipsis_0.3.1        pkgconfig_2.0.3      
#&gt;  [73] reshape_0.8.8         XML_3.99-0.5          farver_2.0.3         
#&gt;  [76] nnet_7.3-14           dbplyr_1.4.4          dynamicTreeCut_1.63-1
#&gt;  [79] AnnotationDbi_1.51.3  tidyselect_1.1.0      labeling_0.3         
#&gt;  [82] rlang_0.4.8           munsell_0.5.0         cellranger_1.1.0     
#&gt;  [85] tools_4.0.2           cli_2.1.0             generics_0.0.2       
#&gt;  [88] RSQLite_2.2.1         ade4_1.7-15           broom_0.7.1          
#&gt;  [91] evaluate_0.14         biomformat_1.17.0     yaml_2.2.1           
#&gt;  [94] ragg_0.4.0            knitr_1.30            bit64_4.0.5          
#&gt;  [97] fs_1.5.0              randomForest_4.6-14   nlme_3.1-149         
#&gt; [100] formatR_1.7           aplot_0.0.6           xml2_1.3.2           
#&gt; [103] compiler_4.0.2        rstudioapi_0.11       png_0.1-7            
#&gt; [106] ggsignif_0.6.0        reprex_0.3.0          treeio_1.13.1        
#&gt; [109] stringi_1.5.3         highr_0.8             ps_1.4.0             
#&gt; [112] desc_1.2.0            Matrix_1.2-18         multtest_2.45.0      
#&gt; [115] vctrs_0.3.4           pillar_1.4.6          lifecycle_0.2.0      
#&gt; [118] rhdf5filters_1.1.3    BiocManager_1.30.10   data.table_1.13.0    
#&gt; [121] latticeExtra_0.6-29   R6_2.4.1              Rmisc_1.5            
#&gt; [124] gridExtra_2.3         IRanges_2.23.10       codetools_0.2-16     
#&gt; [127] lambda.r_1.2.4        MASS_7.3-53           gtools_3.8.2         
#&gt; [130] assertthat_0.2.1      rhdf5_2.33.11         rprojroot_1.3-2      
#&gt; [133] withr_2.3.0           multcomp_1.4-14       S4Vectors_0.27.14    
#&gt; [136] mgcv_1.8-33           parallel_4.0.2        hms_0.5.3            
#&gt; [139] rpart_4.1-15          quadprog_1.5-8        rmarkdown_2.4        
#&gt; [142] rvcheck_0.1.8         base64enc_0.1-3       WGCNA_1.69           
#&gt; [145] Biobase_2.49.1        lubridate_1.7.9</code></pre>
</details>
</div>
<div id="reference" class="section level2">
<h2 class="hasAnchor">
<a href="#reference" class="anchor"></a>9. Reference</h2>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Shuangbin Xu, Guangchuang Yu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
